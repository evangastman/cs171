<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <title>Heroin</title>

    <!-- ADD Libraries-->
    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>




    <!--Stylesheets-->
    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">

    <!-- Get some nice font-->
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>


    <!--------------------------------->
    <!-- FROM HERE ON IT IS HW3 stuff-->
    <!--------------------------------->

    <!-- add own vis classes-->
 
    <script src="js/countvis.js"></script>


    <!-- add own stylesheet-->
    <link rel="stylesheet" type="text/css" href="css/myStyle.css">

</head>

<body>
    <div class="container">
        <h1>Final Project- Heroin in the Year 2012 Data Visualization</h1>

        <div class="row">
            <div class="col-md-8 col-sm-12">
                <p> The following visualization shows you...</p>
            </div>

        </div>


        <div class="row">
            <div class="col-md-12" id="countVis">
                <!-- TODO: delete placeholder svg element -->
            </div>
        </div>


        </div>





        </div>



        <script>
            $(function() { // this function is called after the HTML document is fully loaded


                // variables keeping global knowledge of the data
               

                var allData = [];
                var metaData = {};

                var totalcats = ["number", "HERYR", "HERMON"];

                var crimecats = ["BOOKED", "BKSRVIOL", "BKSMASLT", "BKDRVINF", "BKDRUG", "HERLAWTR"];

                var mhcats = ["MHNSPTR2", "NMHSPTR2", "MHASPTR2"];

                var filters = {
                    income: null,
                    age: null,
                    sex: null
                }

                 function filter (d){
                    if((d["INCOME"] != filters.income && filters.income != null)
                        && (d["CATAG3"] != filters.age && filters.age != null)
                        && (d["IRSEX"] != filters.sex && filters.sex != null))
                        return false;
                    else
                        return true; 
                }


                 // returns array of length 3: population, heroin users in past year, heroin users in past month
                function total (){
                    
                    var totaldata = [0, 0, 0];

                    if(filters.income == null){
                        for(i in metadata){
                            totaldata[0] += metadata[i]["number"];
                            totaldata[1] += metadata[i]["HERYR"];
                            totaldata[2] += metadata[i]["HERMON"];
                        }

                    }

                    else{
                        for(i in metadata){
                            if(metadata[i]["INCOME"] == filters.income){
                                totaldata[0] == metadata[i]["number"];
                                totaldata[1] == metadata[i]["HERYR"];
                                totaldata[2] == metadata[i]["HERMON"];
                                break;
                            }
                        }
                    }

    

                    return totaldata;
                }


                // returns array of number of heroin users fitting each crime category
                function to_crime (){

                    var crimedata = [0, 0, 0, 0, 0, 0];

                    for(i in data){
                        if(filter(data[i])){
                            for(j in crimecats){
                                if(data[i][crimecats[j]] == 1){
                                    crimedata[j] ++;
                                }
                            }
                        }
                    }

                    return crimedata;
                }


                 // returns array of number of heroin users fitting each mental health category
                function to_mh(){

                    var mhdata = [0, 0, 0];

                    for(i in data){
                        if(filter(data[i])){
                            for(j in mhcats){
                                if(data[i][mhcats[j]] == 1){
                                    mhdata[j] ++;
                                }
                            }
                        }
                        
                    }

                    return mhdata;
                }

                var initVis = function() {

                     //var MyEventHandler = new Object();


                    //TODO: Instantiate all Vis Objects here
                    //var count_vis = new CountVis(d3.select("#countVis"), allData, metaData, MyEventHandler);

                    // TODO: bind the eventHandler to the Vis Objects

                }


                var dataLoaded = function(error, _allData, _metaData) {

                    if (!error) {}

                        initVis();
                    }


                var startHere = function(){
                    queue()
                        .defer(d3.json, "data/CS171_UsersOnly_JSON.json")
                        .defer(d3.json, "data/CS171_metaData.json")
                        .await(dataLoaded);

                }

                startHere();

})


        </script>
</body>

</html>